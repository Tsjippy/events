(()=>{"use strict";const e=window.wp.blocks,t=window.wp.i18n,a=window.wp.element,r=window.wp.data,n=window.wp.coreData,s=window.wp.components,l=window.wp.blockEditor,i=window.ReactJSXRuntime,o=JSON.parse('{"UU":"sim/eventmeta"}');(0,e.registerBlockType)(o.UU,{icon:"calendar",edit:({setAttributes:e,attributes:o})=>{const d=(0,l.useBlockProps)(),c=(0,r.useSelect)((e=>e("core/editor").getCurrentPostType()),[]),[p,u]=(0,n.useEntityProp)("postType",c,"meta"),[x,h]=(0,a.useState)("");(0,a.useEffect)((()=>{if(""!=p.eventdetails&&null!=p.eventdetails){let e=JSON.parse(p.eventdetails);null==e.repeat&&(e.repeat={interval:1}),null==e.starttime&&(e.starttime="00:00"),h(e),e.organizer&&y(e.organizer),e.location&&y(e.location)}}),[p]);const m=(e,t,a="")=>{let r={...x};if("startdate"==e)r.startdate=t.split("T")[0],(null==r.enddate||r.enddate<r.startdate)&&(r.enddate=t.split("T")[0]);else if("enddate"==e)r.enddate=t.split("T")[0];else if("starttime"==e){let e=t.split("T")[1];e=e.split(":"),r.starttime=e[0]+":"+e[1]}else if("endtime"==e){let e=t.split("T")[1];e=e.split(":"),r.endtime=e[0]+":"+e[1]}else if(e.startsWith("repeat")){null==r.repeat&&(r.repeat={});let n=e.split("-")[1];if("excludedates"==n||"includedates"==n){null==r.repeat[n]&&(r.repeat[n]=[]);let e=t.split("T")[0],a="added";r.repeat[n].includes(e)?(r.repeat[n]=r.repeat[n].filter((t=>t!=e)),a="removed"):r.repeat[n].push(e),wp.data.dispatch("core/notices").createNotice("success",`Succesfully ${a} the date`,{type:"snackbar",isDismissible:!0})}else"weeks"==n||"months"==n?(null==r.repeat[n]&&(r.repeat[n]=[]),r.repeat[n].includes(a)?r.repeat[n]=r.repeat[n].filter((e=>e!=a)):r.repeat[n].push(a)):r.repeat[n]=t}else r[e]=t;"organizer_id"==e?(j(a),r.organizer=a):"location_id"==e&&(y(a),r.location=a),r=JSON.stringify(r),u({...p,eventdetails:r})},[_,j]=(0,a.useState)(x.organizer),[v,y]=(0,a.useState)(x.location),{users:g,userResolved:b}=(0,r.useSelect)((e=>{if(!_)return{users:[],userResolved:!0};const t={search:_,per_page:100,context:"view"};return{users:e(n.store).getUsers(t),userResolved:e(n.store).hasFinishedResolution("getUsers",[t])}}),[_]),{locations:f,locationResolved:R}=(0,r.useSelect)((e=>{if(!v)return{locations:[],locationResolved:!0};const t=["postType","location",{search:v,per_page:100,context:"view",orderby:"relevance"}];return{locations:e(n.store).getEntityRecords(...t),locationResolved:e(n.store).hasFinishedResolution("getEntityRecords",t)}}),[v]),C=function(){if(!R)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Spinner,{}),(0,i.jsx)("br",{})]});if(""==v||null==v)return"";if(!f?.length)return(0,i.jsxs)("div",{children:[" ",(0,t.__)("No location found","sim")]});let e=f.map((e=>({label:e.title.rendered,value:e.id})));return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(s.RadioControl,{selected:parseInt(x.location_id),options:e,onChange:t=>m("location_id",t,e.filter((e=>t==e.value))[0].label)})})},w=function(){if(!b)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Spinner,{}),(0,i.jsx)("br",{})]});if(""==_||null==_)return"";if(!g?.length)return(0,i.jsxs)("div",{children:[" ",(0,t.__)("No user found","sim")]});let e=g.map((e=>({label:e.name,value:e.id})));return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(s.RadioControl,{selected:parseInt(x.organizer_id),options:e,onChange:t=>m("organizer_id",t,e.filter((e=>t==e.value))[0].label)})})},k=()=>null==x.repeat.excludedates?"":x.repeat.excludedates.map(((e,t)=>(0,i.jsx)(s.DatePicker,{currentDate:x.repeat.excludedates[t],value:e,onChange:e=>{m("repeat-excludedates",e,t)}}))),S=()=>"daily"!=x.repeat.type?"":(0,i.jsxs)(i.Fragment,{children:[(0,t.__)("Repeat interval in days"),(0,i.jsx)(s.__experimentalNumberControl,{onChange:e=>m("repeat-interval",e),value:x.repeat.interval}),(0,i.jsx)("br",{})]}),D=()=>{if("weekly"!=x.repeat.type)return"";null==x.repeat.weeks&&(x.repeat.weeks=[]);let e=["First","Second","Third","Fourth","Fifth","All"].map((e=>(0,i.jsx)(s.CheckboxControl,{label:(0,t.__)(e),checked:x.repeat.weeks.includes(e),onChange:t=>m("repeat-weeks",t,e)})));return(0,i.jsxs)(i.Fragment,{children:[(0,t.__)("Repeat interval in weeks"),(0,i.jsx)(s.__experimentalNumberControl,{onChange:e=>m("repeat-interval",e),value:x.repeat.interval}),(0,i.jsx)("br",{}),(0,t.__)("Select weeks(s) of the month this event should be repeated on"),(0,i.jsx)("br",{}),(0,i.jsx)("div",{class:"flex week-selector",children:e}),(0,i.jsx)("br",{})]})},F=()=>{if("monthly"!=x.repeat.type)return"";null==x.repeat.months&&(x.repeat.months=[]);let e=new Date(x.startdate),a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()],r=parseInt(e.getDate()/7);console.log(r);let n=["first","second","third","fourth","fifth"][r];return(0,i.jsxs)(i.Fragment,{children:[(0,t.__)("Select repeat type"),(0,i.jsx)("br",{}),(0,i.jsxs)(s.__experimentalRadioGroup,{label:"Width",onChange:e=>m("repeat-datetype",e),checked:x.repeat.datetype,children:[(0,i.jsx)(s.__experimentalRadio,{value:"samedate",children:(0,t.__)("On the same day")}),(0,i.jsx)(s.__experimentalRadio,{value:"patterned",children:(0,t.__)(`On the ${n} ${a} of the month`)}),(0,i.jsx)(s.__experimentalRadio,{value:"last",children:(0,t.__)(`On the last ${a} of the month`)}),(0,i.jsx)(s.__experimentalRadio,{value:"lastday",children:(0,t.__)("On the last day of the month")})]}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsx)(T,{})]})},T=()=>{if(null==x.repeat.datetype)return"";if("samedate"==x.repeat.datetype)return(0,i.jsxs)(i.Fragment,{children:[(0,t.__)("Repeat interval in months"),(0,i.jsx)(s.__experimentalNumberControl,{onChange:e=>m("repeat-interval",e),value:x.repeat.interval}),(0,i.jsx)("br",{})]});let e=["All","January","February","March","April","May","June","July","August","September","October","November","December"].map((e=>(0,i.jsx)(s.CheckboxControl,{label:(0,t.__)(e),checked:x.repeat.months.includes(e),onChange:t=>m("repeat-months",t,e)}))),a=e.splice(0,1),r=e.splice(0,6);return(0,i.jsxs)(i.Fragment,{children:[(0,t.__)("Select month(s) this event should be repeated"),(0,i.jsx)("br",{}),(0,i.jsx)("div",{class:"flex month-selector",children:a}),(0,i.jsx)("div",{class:"flex month-selector",children:r}),(0,i.jsx)("div",{class:"flex month-selector",children:e}),(0,i.jsx)("br",{})]})},B=()=>{if("custom_days"!=x.repeat.type)return"";let e=(0,i.jsx)(s.DatePicker,{currentDate:null,onChange:e=>{m("repeat-includedates",e)}});return null==x.repeat.includedates?e:(0,i.jsxs)(i.Fragment,{children:[x.repeat.includedates.map(((e,t)=>(0,i.jsx)(s.DatePicker,{currentDate:x.repeat.includedates[t],value:e,onChange:e=>{m("repeat-includedates",e,t)}}))),e,";"]})},N=()=>{if(null==x.startdate)return"";const e=()=>{if(x.allday)return"";let e=null==x.starttime?"00:00:00":x.starttime,a=null==x.endtime?"00:00:00":x.endtime;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{class:"center",children:(0,t.__)("Start time","sim")}),(0,i.jsx)(s.TimePicker,{currentTime:"1986-10-18T"+e,onChange:e=>m("starttime",e),__nextRemoveHelpButton:!0,__nextRemoveResetButton:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{class:"center",children:(0,t.__)("End time","sim")}),(0,i.jsx)(s.TimePicker,{currentTime:"1986-10-18T"+a,onChange:e=>m("endtime",e),__nextRemoveHelpButton:!0,__nextRemoveResetButton:!0})]})]})};return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{class:"time-pickers flex",children:[(0,i.jsx)(e,{}),(0,i.jsx)(s.CheckboxControl,{label:(0,t.__)("This is an all day event"),onChange:e=>m("allday",e),checked:x.allday})]})})};return(0,i.jsxs)("div",{...d,children:[(0,i.jsx)("h2",{children:(0,t.__)("Event Details")}),(0,i.jsxs)("div",{class:"date-pickers flex",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{class:"center",children:(0,t.__)("Start date","sim")}),(0,i.jsx)(s.DatePicker,{currentDate:x.startdate?x.startdate:null,onChange:e=>m("startdate",e),__nextRemoveHelpButton:!0,__nextRemoveResetButton:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{class:"center",children:(0,t.__)("End date","sim")}),(0,i.jsx)(s.DatePicker,{currentDate:x.enddate?x.enddate:null,onChange:e=>m("enddate",e),__nextRemoveHelpButton:!0,__nextRemoveResetButton:!0})]})]}),(0,i.jsx)(N,{}),null==x.endtime&&(null==x.allday||!x.allday)||x.enddate==x.startdate&&x.endtime<=x.starttime&&(null==x.allday||!x.allday)?"":(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{children:(0,t.__)("Use searchbox below to search for a location","sim")}),(0,i.jsx)(s.SearchControl,{onChange:y,value:v}),(0,i.jsx)(C,{}),(0,i.jsx)("br",{}),(0,i.jsx)("i",{children:(0,t.__)("Use searchbox below to search for an user to add as organizer","sim")}),(0,i.jsx)(s.SearchControl,{onChange:j,value:_}),(0,i.jsx)(w,{}),(0,i.jsx)("br",{}),(0,i.jsx)(s.Button,{variant:"primary",className:"repeat-button",onClick:e=>m("isrepeated",!x.isrepeated),children:"Repeat this event"}),(0,i.jsx)("br",{}),null!=x.isrepeated&&x.isrepeated?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("br",{}),(0,i.jsxs)("div",{id:"event-repeat-details",children:[(0,t.__)("Select repetition type"),(0,i.jsx)("br",{}),(0,i.jsxs)(s.__experimentalRadioGroup,{label:"Width",onChange:e=>m("repeat-type",e),checked:x.repeat.type,children:[(0,i.jsx)(s.__experimentalRadio,{value:"daily",children:"Daily"}),(0,i.jsx)(s.__experimentalRadio,{value:"weekly",children:"Weekly"}),(0,i.jsx)(s.__experimentalRadio,{value:"monthly",children:"Monthly"}),(0,i.jsx)(s.__experimentalRadio,{value:"yearly",children:"Yearly"}),(0,i.jsx)(s.__experimentalRadio,{value:"custom_days",children:"Custom Days"})]}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsx)(S,{}),(0,i.jsx)(D,{}),(0,i.jsx)(F,{}),(0,i.jsx)(B,{}),(0,t.__)("Stop repetition"),(0,i.jsx)(s.RadioControl,{selected:x.repeat.stop,options:[{label:"Never",value:"never"},{label:"On this date",value:"date"},{label:"After this amount of repeats",value:"after"}],onChange:e=>m("repeat-stop",e)}),null==x.repeat.stop||"never"==x.repeat.stop?"":"date"==x.repeat.stop?(0,i.jsxs)(i.Fragment,{children:[(0,t.__)("Last date"),(0,i.jsx)(s.DatePicker,{currentDate:x.repeat.enddate,onChange:e=>m("repeat-enddate",e),__nextRemoveHelpButton:!0,__nextRemoveResetButton:!0})]}):(0,i.jsxs)(i.Fragment,{children:[(0,t.__)("Maximum occurences"),(0,i.jsx)(s.__experimentalNumberControl,{onChange:e=>m("repeat-amount",e),value:x.repeat.amount}),(0,i.jsx)("br",{})]}),(0,i.jsx)("br",{}),(0,t.__)("Exclude dates, click to select or deselect"),(0,i.jsx)(k,{}),(0,i.jsx)(s.DatePicker,{currentDate:null,onChange:e=>m("repeat-excludedates",e,0),__nextRemoveHelpButton:!0,__nextRemoveResetButton:!0})]})]}):""]})]})},save:()=>null})})();